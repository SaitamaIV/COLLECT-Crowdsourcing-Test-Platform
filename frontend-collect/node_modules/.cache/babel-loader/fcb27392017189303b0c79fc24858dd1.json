{"remainingRequest":"C:\\Users\\picturesque\\Desktop\\frontend-collect\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\picturesque\\Desktop\\frontend-collect\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\picturesque\\Desktop\\frontend-collect\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\picturesque\\Desktop\\frontend-collect\\src\\components\\common\\FileUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\picturesque\\Desktop\\frontend-collect\\src\\components\\common\\FileUpload.vue","mtime":1653401045267},{"path":"C:\\Users\\picturesque\\Desktop\\frontend-collect\\babel.config.js","mtime":1653401012640},{"path":"C:\\Users\\picturesque\\Desktop\\frontend-collect\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1653401020224},{"path":"C:\\Users\\picturesque\\Desktop\\frontend-collect\\node_modules\\babel-loader\\lib\\index.js","mtime":1653401017578},{"path":"C:\\Users\\picturesque\\Desktop\\frontend-collect\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1653401020224},{"path":"C:\\Users\\picturesque\\Desktop\\frontend-collect\\node_modules\\vue-loader\\lib\\index.js","mtime":1653401043277}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgc3RvcmFnZSBmcm9tICJAL3V0aWxzL3N0b3JhZ2UiOwppbXBvcnQgYmFzZSBmcm9tICJAL3V0aWxzL2Jhc2UiOwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIC8vIOafpeeci+Wkp+WbvgogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgLy8g5p+l55yL5aSn5Zu+CiAgICAgIGRpYWxvZ0ltYWdlVXJsOiAiIiwKICAgICAgLy8g57uE5Lu25riy5p+T5Zu+54mH55qE5pWw57uE5a2X5q6177yM5pyJ54m55q6K5qC85byP6KaB5rGCCiAgICAgIGZpbGVMaXN0OiBbXSwKICAgICAgZmlsZVVybExpc3Q6IFtdLAogICAgICBteUhlYWRlcnM6IHt9CiAgICB9OwogIH0sCiAgcHJvcHM6IFsidGlwIiwgImFjdGlvbiIsICJsaW1pdCIsICJtdWx0aXBsZSIsICJmaWxlVXJscyJdLAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXQoKTsKICAgIHRoaXMubXlIZWFkZXJzID0gewogICAgICAnVG9rZW4nOiBzdG9yYWdlLmdldCgiVG9rZW4iKQogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBmaWxlVXJsczogZnVuY3Rpb24gZmlsZVVybHModmFsLCBvbGRWYWwpIHsKICAgICAgLy8gICBjb25zb2xlLmxvZygibmV3OiAlcywgb2xkOiAlcyIsIHZhbCwgb2xkVmFsKTsKICAgICAgdGhpcy5pbml0KCk7CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgLy8g6K6h566X5bGe5oCn55qEIGdldHRlcgogICAgZ2V0QWN0aW9uVXJsOiBmdW5jdGlvbiBnZXRBY3Rpb25VcmwoKSB7CiAgICAgIC8vIHJldHVybiBiYXNlLnVybCArIHRoaXMuYWN0aW9uICsgIj90b2tlbj0iICsgc3RvcmFnZS5nZXQoInRva2VuIik7CiAgICAgIHJldHVybiAiLyIuY29uY2F0KHRoaXMuJGJhc2UubmFtZSwgIi8iKSArIHRoaXMuYWN0aW9uOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLy8g5Yid5aeL5YyWCiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAvLyAgIGNvbnNvbGUubG9nKHRoaXMuZmlsZVVybHMpOwogICAgICBpZiAodGhpcy5maWxlVXJscykgewogICAgICAgIHRoaXMuZmlsZVVybExpc3QgPSB0aGlzLmZpbGVVcmxzLnNwbGl0KCIsIik7CiAgICAgICAgdmFyIGZpbGVBcnJheSA9IFtdOwogICAgICAgIHRoaXMuZmlsZVVybExpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgIHZhciB1cmwgPSBpdGVtOwogICAgICAgICAgdmFyIG5hbWUgPSBpbmRleDsKICAgICAgICAgIHZhciBmaWxlID0gewogICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICB1cmw6IHVybAogICAgICAgICAgfTsKICAgICAgICAgIGZpbGVBcnJheS5wdXNoKGZpbGUpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuc2V0RmlsZUxpc3QoZmlsZUFycmF5KTsKICAgICAgfQogICAgfSwKICAgIGhhbmRsZUJlZm9yZVVwbG9hZDogZnVuY3Rpb24gaGFuZGxlQmVmb3JlVXBsb2FkKGZpbGUpIHt9LAogICAgLy8g5LiK5Lyg5paH5Lu25oiQ5Yqf5ZCO5omn6KGMCiAgICBoYW5kbGVVcGxvYWRTdWNjZXNzOiBmdW5jdGlvbiBoYW5kbGVVcGxvYWRTdWNjZXNzKHJlcywgZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgaWYgKHJlcyAmJiByZXMuY29kZSA9PT0gMCkgewogICAgICAgIGZpbGVMaXN0W2ZpbGVMaXN0Lmxlbmd0aCAtIDFdWyJ1cmwiXSA9IHRoaXMuJGJhc2UudXJsICsgInVwbG9hZC8iICsgZmlsZS5yZXNwb25zZS5maWxlOwogICAgICAgIHRoaXMuc2V0RmlsZUxpc3QoZmlsZUxpc3QpOwogICAgICAgIHRoaXMuJGVtaXQoImNoYW5nZSIsIHRoaXMuZmlsZVVybExpc3Quam9pbigiLCIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpOwogICAgICB9CiAgICB9LAogICAgLy8g5Zu+54mH5LiK5Lyg5aSx6LSlCiAgICBoYW5kbGVVcGxvYWRFcnI6IGZ1bmN0aW9uIGhhbmRsZVVwbG9hZEVycihlcnIsIGZpbGUsIGZpbGVMaXN0KSB7CiAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuaWh+S7tuS4iuS8oOWksei0pSIpOwogICAgfSwKICAgIC8vIOenu+mZpOWbvueJhwogICAgaGFuZGxlUmVtb3ZlOiBmdW5jdGlvbiBoYW5kbGVSZW1vdmUoZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgdGhpcy5zZXRGaWxlTGlzdChmaWxlTGlzdCk7CiAgICAgIHRoaXMuJGVtaXQoImNoYW5nZSIsIHRoaXMuZmlsZVVybExpc3Quam9pbigiLCIpKTsKICAgIH0sCiAgICAvLyDmn6XnnIvlpKflm74KICAgIGhhbmRsZVVwbG9hZFByZXZpZXc6IGZ1bmN0aW9uIGhhbmRsZVVwbG9hZFByZXZpZXcoZmlsZSkgewogICAgICB0aGlzLmRpYWxvZ0ltYWdlVXJsID0gZmlsZS51cmw7CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICB9LAogICAgLy8g6ZmQ5Yi25Zu+54mH5pWw6YePCiAgICBoYW5kbGVFeGNlZWQ6IGZ1bmN0aW9uIGhhbmRsZUV4Y2VlZChmaWxlcywgZmlsZUxpc3QpIHsKICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCJcdTY3MDBcdTU5MUFcdTRFMEFcdTRGMjAiLmNvbmNhdCh0aGlzLmxpbWl0LCAiXHU1RjIwXHU1NkZFXHU3MjQ3IikpOwogICAgfSwKICAgIC8vIOmHjeaWsOWvuWZpbGVMaXN06L+b6KGM6LWL5YC8CiAgICBzZXRGaWxlTGlzdDogZnVuY3Rpb24gc2V0RmlsZUxpc3QoZmlsZUxpc3QpIHsKICAgICAgdmFyIGZpbGVBcnJheSA9IFtdOwogICAgICB2YXIgZmlsZVVybEFycmF5ID0gW107IC8vIOacieS6m+WbvueJh+S4jeaYr+WFrOW8gOeahO+8jOaJgOS7pemcgOimgeaQuuW4pnRva2Vu5L+h5oGv5YGa5p2D6ZmQ5qCh6aqMCgogICAgICB2YXIgdG9rZW4gPSBzdG9yYWdlLmdldCgidG9rZW4iKTsKICAgICAgZmlsZUxpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICB2YXIgdXJsID0gaXRlbS51cmwuc3BsaXQoIj8iKVswXTsKICAgICAgICB2YXIgbmFtZSA9IGl0ZW0ubmFtZTsKICAgICAgICB2YXIgZmlsZSA9IHsKICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICB1cmw6IHVybCArICI/dG9rZW49IiArIHRva2VuCiAgICAgICAgfTsKICAgICAgICBmaWxlQXJyYXkucHVzaChmaWxlKTsKICAgICAgICBmaWxlVXJsQXJyYXkucHVzaCh1cmwpOwogICAgICB9KTsKICAgICAgdGhpcy5maWxlTGlzdCA9IGZpbGVBcnJheTsKICAgICAgdGhpcy5maWxlVXJsTGlzdCA9IGZpbGVVcmxBcnJheTsKICAgIH0KICB9Cn07"},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2BA;AACA;AACA;AACAA,MADA,kBACA;AACA;AACA;AACAC,0BAFA;AAGA;AACAC,wBAJA;AAKA;AACAC,kBANA;AAOAC,qBAPA;AAQAC;AARA;AAUA,GAZA;AAaAC,2DAbA;AAcAC,SAdA,qBAcA;AACA;AACA;AACA;AADA;AAGA,GAnBA;AAoBAC;AACAC;AACA;AACA;AACA;AAJA,GApBA;AA0BAC;AACA;AACAC;AACA;AACA;AACA;AALA,GA1BA;AAiCAC;AACA;AACAC,QAFA,kBAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,sBADA;AAEAC;AAFA;AAIAC;AACA,SARA;AASA;AACA;AACA,KAlBA;AAmBAC,sBAnBA,8BAmBAC,IAnBA,EAmBA,CAEA,CArBA;AAsBA;AACAC,uBAvBA,+BAuBAC,GAvBA,EAuBAF,IAvBA,EAuBAf,QAvBA,EAuBA;AACA;AACAA,+CACA,+CADA;AAEA;AACA;AACA,OALA,MAKA;AACA;AACA;AACA,KAhCA;AAiCA;AACAkB,mBAlCA,2BAkCAC,GAlCA,EAkCAJ,IAlCA,EAkCAf,QAlCA,EAkCA;AACA;AACA,KApCA;AAqCA;AACAoB,gBAtCA,wBAsCAL,IAtCA,EAsCAf,QAtCA,EAsCA;AACA;AACA;AACA,KAzCA;AA0CA;AACAqB,uBA3CA,+BA2CAN,IA3CA,EA2CA;AACA;AACA;AACA,KA9CA;AA+CA;AACAO,gBAhDA,wBAgDAC,KAhDA,EAgDAvB,QAhDA,EAgDA;AACA;AACA,KAlDA;AAmDA;AACAwB,eApDA,uBAoDAxB,QApDA,EAoDA;AACA;AACA,4BAFA,CAGA;;AACA;AACAA;AACA;AACA;AACA;AACAW,oBADA;AAEAC;AAFA;AAIAC;AACAY;AACA,OATA;AAUA;AACA;AACA;AArEA;AAjCA","names":["data","dialogVisible","dialogImageUrl","fileList","fileUrlList","myHeaders","props","mounted","watch","fileUrls","computed","getActionUrl","methods","init","name","url","fileArray","handleBeforeUpload","file","handleUploadSuccess","res","handleUploadErr","err","handleRemove","handleUploadPreview","handleExceed","files","setFileList","fileUrlArray"],"sourceRoot":"src/components/common","sources":["FileUpload.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 上传文件组件 -->\r\n    <el-upload\r\n      ref=\"upload\"\r\n      :action=\"getActionUrl\"\r\n      list-type=\"picture-card\"\r\n      :multiple=\"multiple\"\r\n      :limit=\"limit\"\r\n      :headers=\"myHeaders\"\r\n      :file-list=\"fileList\"\r\n      :on-exceed=\"handleExceed\"\r\n      :on-preview=\"handleUploadPreview\"\r\n      :on-remove=\"handleRemove\"\r\n      :on-success=\"handleUploadSuccess\"\r\n      :on-error=\"handleUploadErr\"\r\n      :before-upload=\"handleBeforeUpload\"\r\n    >\r\n      <i class=\"el-icon-plus\"></i>\r\n      <div slot=\"tip\" class=\"el-upload__tip\" style=\"color:#838fa1;\">{{tip}}</div>\r\n    </el-upload>\r\n    <el-dialog :visible.sync=\"dialogVisible\" size=\"tiny\" append-to-body>\r\n      <img width=\"100%\" :src=\"dialogImageUrl\" alt>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n<script>\r\nimport storage from \"@/utils/storage\";\r\nimport base from \"@/utils/base\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      // 查看大图\r\n      dialogVisible: false,\r\n      // 查看大图\r\n      dialogImageUrl: \"\",\r\n      // 组件渲染图片的数组字段，有特殊格式要求\r\n      fileList: [],\r\n      fileUrlList: [],\r\n      myHeaders:{}\r\n    };\r\n  },\r\n  props: [\"tip\", \"action\", \"limit\", \"multiple\", \"fileUrls\"],\r\n  mounted() {\r\n    this.init();\r\n    this.myHeaders= {\r\n      'Token':storage.get(\"Token\")\r\n    }\r\n  },\r\n  watch: {\r\n    fileUrls: function(val, oldVal) {\r\n      //   console.log(\"new: %s, old: %s\", val, oldVal);\r\n      this.init();\r\n    }\r\n  },\r\n  computed: {\r\n    // 计算属性的 getter\r\n    getActionUrl: function() {\r\n      // return base.url + this.action + \"?token=\" + storage.get(\"token\");\r\n      return `/${this.$base.name}/` + this.action;\r\n    }\r\n  },\r\n  methods: {\r\n    // 初始化\r\n    init() {\r\n      //   console.log(this.fileUrls);\r\n      if (this.fileUrls) {\r\n        this.fileUrlList = this.fileUrls.split(\",\");\r\n        let fileArray = [];\r\n        this.fileUrlList.forEach(function(item, index) {\r\n          var url = item;\r\n          var name = index;\r\n          var file = {\r\n            name: name,\r\n            url: url\r\n          };\r\n          fileArray.push(file);\r\n        });\r\n        this.setFileList(fileArray);\r\n      }\r\n    },\r\n    handleBeforeUpload(file) {\r\n\t\r\n    },\r\n    // 上传文件成功后执行\r\n    handleUploadSuccess(res, file, fileList) {\r\n      if (res && res.code === 0) {\r\n        fileList[fileList.length - 1][\"url\"] =\r\n          this.$base.url + \"upload/\" + file.response.file;\r\n        this.setFileList(fileList);\r\n        this.$emit(\"change\", this.fileUrlList.join(\",\"));\r\n      } else {\r\n        this.$message.error(res.msg);\r\n      }\r\n    },\r\n    // 图片上传失败\r\n    handleUploadErr(err, file, fileList) {\r\n      this.$message.error(\"文件上传失败\");\r\n    },\r\n    // 移除图片\r\n    handleRemove(file, fileList) {\r\n      this.setFileList(fileList);\r\n      this.$emit(\"change\", this.fileUrlList.join(\",\"));\r\n    },\r\n    // 查看大图\r\n    handleUploadPreview(file) {\r\n      this.dialogImageUrl = file.url;\r\n      this.dialogVisible = true;\r\n    },\r\n    // 限制图片数量\r\n    handleExceed(files, fileList) {\r\n      this.$message.warning(`最多上传${this.limit}张图片`);\r\n    },\r\n    // 重新对fileList进行赋值\r\n    setFileList(fileList) {\r\n      var fileArray = [];\r\n      var fileUrlArray = [];\r\n      // 有些图片不是公开的，所以需要携带token信息做权限校验\r\n      var token = storage.get(\"token\");\r\n      fileList.forEach(function(item, index) {\r\n        var url = item.url.split(\"?\")[0];\r\n        var name = item.name;\r\n        var file = {\r\n          name: name,\r\n          url: url + \"?token=\" + token\r\n        };\r\n        fileArray.push(file);\r\n        fileUrlArray.push(url);\r\n      });\r\n      this.fileList = fileArray;\r\n      this.fileUrlList = fileUrlArray;\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n</style>\r\n"]}]}